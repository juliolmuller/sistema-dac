<?xml version="1.0" encoding="UTF-8" ?>

<ui:composition template="/WEB-INF/templates/layout.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
        xmlns:p="http://primefaces.org/ui"
        xmlns:my="http://lacussoft.com/sijoga/tags">

    <ui:define name="content">
        <div class="container">
            <h:panelGroup id="alerts" layout="block">
                <my:toasts messages="#{facesContext.messageList}" />
            </h:panelGroup>

            <h:panelGroup rendered="#{processBean.process == null}">
                <div class="row">
                    <div class="mb-3 p-1">
                        Processo não encontrado.
                    </div>
                </div>
            </h:panelGroup>

            <h:panelGroup rendered="#{processBean.process != null}">
                <h:form id="process-form" prependId="false">
                    <h2>Processo ##{processBean.process.id}</h2>
                    <h:inputHidden value="#{processBean.processId}" />
                    <div class="row">
                        <div class="mb-3 p-1">
                            <h4>Descrição:</h4>
                            #{processBean.process.description}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-md-3 font-weight-bold">
                            Juíz do caso:
                        </div>
                        <div class="col-12 col-md-9">
                            #{processBean.process.judge.name}
                            (ID ##{processBean.process.judge.id})
                        </div>
                        <div class="col-12 col-md-3 font-weight-bold">
                            Parte promovente:
                        </div>
                        <div class="col-12 col-md-9">
                            #{processBean.process.promoter.name}
                            (CPF #{processBean.process.promoter.cpf})
                        </div>
                        <div class="col-12 col-md-3 font-weight-bold">
                            Advogado de acusação:
                        </div>
                        <div class="col-12 col-md-9">
                            #{processBean.process.promoter.lawyer.name}
                            (OAB ##{processBean.process.promoter.lawyer.oab})
                        </div>
                        <div class="col-12 col-md-3 font-weight-bold">
                            Parte promovida:
                        </div>
                        <div class="col-12 col-md-9">
                            #{processBean.process.promoted.name}
                            (CPF #{processBean.process.promoted.cpf})
                        </div>
                        <div class="col-12 col-md-3 font-weight-bold">
                            Advogado de defesa
                        </div>
                        <div class="col-12 col-md-9">
                            #{processBean.process.promoted.lawyer.name}
                            (OAB ##{processBean.process.promoted.lawyer.oab})
                        </div>
                    </div>
                    <h:panelGroup layout="block" rendered="#{not processBean.phaseFormVisible}">
                        <div class="row justify-content-end my-2">
                            <h:commandButton value="+ Nova Fase}" action="#{processBean.viewPhaseForm()}" />
                        </div>
                        <style>
                            thead th {
                                color: #fff;
                                background-color: #343a40;
                                border-color: #454d55;
                            }
                            tr td:last-child {
                                width: 152px;
                            }
                        </style>
                        <h:dataTable value="#{processBean.processPhases}" var="p" rendered="#{processBean.processPhases.rowCount > 0}" styleClass="table table-hover">
                            <h:column>
                                <f:facet name="header">Título</f:facet>
                                <h:outputText value="#{p.title}" />
                            </h:column>
                            <h:column>
                                <f:facet name="header">Status</f:facet>
                                <h:outputText value="#{p.response.status.toString().toUpperCase()}" rendered="#{p.response != null}" />
                                <h:outputText value="EM ANÁLISE" rendered="#{p.response == null}" />
                            </h:column>
                            <h:column>
                                <f:facet name="header">Criado em</f:facet>
                                <h:outputText value="#{p.createdAt}">
                                    <f:convertDateTime locale="pt-BR" pattern="dd-MMM-yyyy hh:mm" />
                                </h:outputText>
                            </h:column>
                            <h:column>
                                <h:commandLink value="Detalhes" action="#{processBean.viewPhaseForm(p.id)}" />
                            </h:column>
                        </h:dataTable>
                    </h:panelGroup>
                    <h:panelGroup layout="block" rendered="#{processBean.phaseFormVisible}">
                        <h3>Faze de Processo ##{processBean.phase.id}</h3>
                        <h4><h:outputText value="#{processBean.phase.title}" /></h4>
                        <p><h:outputText value="#{processBean.phase.description}" /></p>
                        <h:link value="Fechar" outcome="index?id=#{processBean.process.id}" />
                    </h:panelGroup>
                </h:form>
            </h:panelGroup>

            <h:link value="Voltar" outcome="/index" />
        </div>
    </ui:define>

</ui:composition>
